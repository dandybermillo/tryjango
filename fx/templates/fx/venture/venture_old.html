{% extends 'fx/base.html' %}
{% load custom_tags%}
{% load crispy_forms_tags %}



{% block sub_content %}

<style>
    /*Trigger Button*/
    .login-trigger {
        font-weight: bold;
        color: #fff;
        background: linear-gradient(to bottom right, #B05574, #F87E7B);
        padding: 15px 30px;
        border-radius: 30px;
        position: relative;
        top: 50%;
    }

    /*Modal*/
    h4 {
        font-weight: bold;
        color: #fff;
    }

    .close {
        color: #fff;
        transform: scale(1.2)
    }

    .modal-content {
        font-weight: bold;
        background: linear-gradient(to bottom right, #F87E7B, #B05574);
    }

    /* .form-control {
        margin: 1em 0;
    } */

    .form-control:hover,
    .form-control:focus {
        box-shadow: none;
        border-color:blue;
    }

    .username,
    .password {
        border: none;
        border-radius: 0;
        box-shadow: none;
        border-bottom: 2px solid #eee;
        padding-left: 0;
        font-weight: bold;
        background: transparent;
    }

    .form-control::-webkit-input-placeholder {
        color: #eee;
    }

    .form-control:focus::-webkit-input-placeholder {
        font-weight: bold;
        color: #fff;
    }

    .login {
        padding: 6px 20px;
        border-radius: 20px;
        background: none;
        border: 2px solid #FAB87F;
        color: #FAB87F;
        font-weight: bold;
        transition: all .5s;
        margin-top: 1em;
    }

    .login:hover {
        background: #FAB87F;
        color: #fff;
    }




    /* qrcode */
    #preview {
        width: 40%;
        height: 40%;
    }

    div.preview {

        float: left;
    }

    /* end qrcode */

    #id_amount,
    .small-size,
    #id_cc {
        font-size: 1.2rem;
        padding-left: 1rem;
    }

    .container {

        width: 80%;

    }

    .saving-info-container div {
        border-left: 5px solid green;
        width: 100%;

    }


    #id_wallet-transaction_type,
    #id_transaction_type {
        /* id="id_wallet-transaction_type" */
        display: block;
    }

    div.form-group {
        padding-left: 0px;

    }
</style>

<button type="button" class="btn btn-secondary">Secondary</button>


<div id="login" class="modal fade" role="dialog">
    <div class="modal-dialog  modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <button data-dismiss="modal" class="close">&times;</button>
                <h4>Authenticate Member</h4>
                <div class="scanner">
                    <video id="preview"></video></div>
                <div id="authenticate-alert" class="alert alert-danger" role="alert" style="display:none">
                    Invalid username or password
                </div>
                <form>
                    <br>
                    <input type="text" name="customer_id" id="customer_id" class="customer-username form-control" placeholder="Username" />
                    <input type="password" id ="customer-password" name="password" class="password form-control" placeholder="password" />
                    <br>

                    <button class="btn login" id="btn-login" >AGREE</button>
                    <button class="btn login" type="cancel"> CANCEL</button> 
                </form>
            </div>
        </div>
    </div>
</div>

{% include 'fx/e_wallet/yes_no_modal.html' with code='venture_payment' float='right'  %}


<div class="container" style="border:none;width: 90%;">
    <div class="tcard">
        <div>
            <p style="font-size: 1.5rem;"> PRODUCT ORDER FORM</p>
        </div>
        {% if venture.errors %}
        {% for field in venture %}
        {% for error in field.errors %}
        <div class="alert alert-danger">
            <strong>{{ error|escape }}</strong>
        </div>
        {% endfor %}
        {% endfor %}

        {% for error in form.non_field_errors %}
        <div class="alert alert-danger">
            <strong>{{ error|escape }}</strong>
        </div>
        {% endfor %}
        {% endif %}

        {% for message in messages %}

        <div id="payment-alert-messages" class="alert {{ message.tags }} alert-dismissible" role="alert">
            <a class="close" href="#" data-dismiss="alert">Ã—</a>
            {{ message }}
        </div>
        {% endfor %}
        <div id="venture-payment-failed-alert" class="alert alert-danger" role="alert" style="display:none">
            Please fill in the box with asterisk sign(*). Thank you.
        </div>

        <div>




            <form action="" class="needs-validation" id="form_venture" method="POST">
                {% csrf_token %}
                <div hidden>
                    {{venture.source_type}}{{venture.customer}}{{venture.percent}}{{venture.seller_source_id}}
                    {{ venture.date_entered}}{{venture.seller}}{{venture.transaction_type}}{{venture.customer_source_id}}{{venture.category}}{{venture.flag}}
                </div>
                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="venture-total-txt" class="col-form-label">TOTAL COST<span
                                class="asteriskField">*</span> </label>
                        <input id="venture-total-txt" required type="number" step='any' min=5 max="10000"
                            class="mid-size form-control" value="{{venture.totalCost}}">
                    </div>

                    <div class="form-group col-md-3">
                        <label for="main-source-drop" class="col-form-label">SOURCE<span
                                class="asteriskField">*</span></label>
                        <div class="dropdown" id="main-source-drop">
                            <button class="left-position small-size btn btn-light dropdown-toggle" type="button"
                                id="source-cash-drop" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                style="border:1px solid #ced4da;width: 100%;">

                                {% ifequal venture.source_type.value 'W' %} WALLET ACCOUNT {%else%}CASH {%endifequal%}
                            </button>
                            <div class="dropdown-menu" aria-labelledby="source-cash-drop">
                                <button class="source-cash dropdown-item" type="button">CASH</button>
                                <button class="source-cash dropdown-item" type="button">WALLET ACCOUNT</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group col-md-3">
                        <label for="main-percent-drop" class="col-form-label">PERCENTAGE </label>
                        <div class="dropdown" id="main-percent-drop">
                            <button class=" left-position small-size btn btn-light dropdown-toggle " type="button"
                                id="percent-drop" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                name="percent" style="border:1px solid #ced4da;width:100%;">
                                {{venture.percent.value}}%
                            </button>
                            <!-- .custom {
                                width: 78px !important;
                            } -->
                            <div class="dropdown-menu" aria-labelledby="percent-drop">
                                <button class="cc-percent dropdown-item" type="button">95% </button>
                                <button class="cc-percent dropdown-item" type="button">90% </button>
                                <button class="cc-percent dropdown-item" type="button">85% </button>
                                <button class="cc-percent dropdown-item" type="button">80% </button>
                                <button class="cc-percent dropdown-item" type="button">75% </button>
                                <button class="cc-percent dropdown-item" type="button">70% </button>
                                <button class="cc-percent dropdown-item" type="button">65% </button>
                                <button class="cc-percent dropdown-item" type="button">60% </button>
                                <button class="cc-percent dropdown-item" type="button">50% </button>
                            </div>
                        </div>
                    </div>

                    <!-- <div class="form-group col-md-6">
                        {% ifequal venture.role_type.value 'S' %}
                        <label id="venture-total_owing-lbl" for="venture-total_owing-txt" class="col-form-label">SELLER
                            {% if venture.id > 0 %} RECEIVED {%else%} RECEIVES {%endif%}</label>
                        {%else%}

                        {%ifequal venture.request_action 'trade' %}
                        <label id="venture-total_owing-lbl" for="venture-total_owing-txt" class="col-form-label">BUYER
                            {% if venture.id > 0 %} PAID {%else%} PAYS {%endif%} </label>
                        {%else%}
                        <label id="venture-total_owing-lbl" for="venture-total_owing-txt"
                            class="col-form-label">CUSTOMER {% if venture.id > 0 %} PAID {%else%} PAYS {%endif%}</label>
                        {%endifequal%}
                        {%endifequal%}
                        <input id="venture-total_owing-txt" type="text" readonly style="border:1px solid #ced4da;"
                            class="mid-size gray-background  form-control" value="{% if venture.amount.value > 0%}  {%ifequal venture.source_type.value 'W'  %}P {{venture.amount.value}}  (FROM WALLET ACCOUNT)  {%else%}  P {{venture.amount.value}} {%endifequal%}  {% else %} 
                              {% endif %}">
                    </div> -->

                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <!-- <label for="id_saving" class="col-form-label">Saving(Deposit):</label> -->
                        {{ venture.amount|as_crispy_field}}
                    </div>
                    <div class="form-group col-md-6">
                        {{ venture.cc|as_crispy_field}}
                    </div>

                </div>
                <div class="form-row">


                    <div class="form-group col-md-6">
                        <label for="venture-description-txt" class="col-form-label">DESCRIPTION</label>
                        <textarea style="font-size: 1rem;" name="venture_note" class="form-control"
                            id="venture-description-txt" maxlength="100">{{venture.note}}</textarea>

                    </div>
                </div>





                <div class="form-row">
                    <div class="form-group col-md-6 mb-0">
                    </div>
                </div>


                <div>

                    {%if post_data %}
                    <a class="hide btn btn-secondary btn-md"
                        href="{% url 'fx:display_member_info_url' member_info.id  %}">Close This Form </a>

                    <a class="edit_button btn btn-warning btn-md"
                        href="{% url 'fx:create_update_venture_url' member_info.id venture.id    %}">
                        Make Changes</a>
                    {% else %}
                    <a class="hide btn btn-secondary btn-md"
                        href="{% url 'fx:display_member_info_url' member_info.id  %}">Close This Form </a>
                    <input id="venture-done" class="done btn btn-primary btn-md" type="button" value="I'm Done" />
                    <input hidden id="venture-submit-btn" type="submit" name="Submit" value="SAVE" />
                    {% if venture.id > 0 %}
                    <a hidden id="venture-delete"
                        href="{% url 'fx:delete_venture_url' member_info.id  venture.id  %}"></a>

                    <input style="float:right" id="venture-delete-this" class="btn btn-danger btn-md" type="button"
                        value="Delete this" />

                    {%endif%}
                    {%endif%}
                </div>
            </form>
            <br>
        </div>
    </div>
</div>


<div class="modal fade" id="venture-payment-transaction-modal" data-backdrop="static" data-keyboard="false"
    tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">PRODUCT ORDER FORM REVIEW</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="review-venture-form">
                    <form>
                        <div class="form-row">

                           



                        </div>
                        <div class="form-row">
                            <label id="review-venture-customer-lbl" for="review-venture-customer-txt"
                                class="col-form-label">Customer</label>
                            <div class="form-group col-md-7">

                                <input id="review-venture-customer-txt" type="text" readonly
                                    class="mid-size  form-control">
                            </div>
                            <label for="review-venture-customer_id-txt" class="col-form-label">ID<span
                                class="asteriskField">*</span></label>
                        <div class="form-group col-md-3">

                            <input id="review-venture-customer_id-txt" type="text" name="venture-customer-member_id"
                                readonly class="mid-size form-control" style="border:1px solid #ced4da;">
                        </div>
                        </div>
                        <div class="review form-group row">
                            <label for="review-venture-balance-txt" class="col-sm-1 col-form-label"
                                style="padding-left: 8px">CM Balance:</label>
                            <div class="form-group col-md-7">
                                <input id="review-venture-balance-txt" type="text" readonly
                                    class="mid-size form-control">
                            </div>
                        </div>
                        <div class="review form-group row">

                            <label for="review-venture-total-txt" class="col-md-1 col-form-label">TOTAL COST<span
                                    class="asteriskField">*</span></label>
                            <div class="col-sm-5">
                                <input type="text" readonly class="mid-size review form-control"
                                    id="review-venture-total-txt" value="">
                            </div>
                            <label for="review-venture-source-txt" class="col-sm-1 col-form-label">Source<span
                                    class="asteriskField">*</span></label>
                            <div class="col-sm-5">
                                <input type="text" readonly class="small-size  review form-control"
                                    id="review-venture-source-txt" value="">
                            </div>

                            <!-- <label id="review-total_owing-txt" for="review-venture-total_owing-txt"
                                class="col-md-1 col-form-label">CUSTOMER PAYS
                            </label>
                            <div class="col-md-5">
                                <input type="text" readonly class="mid-size review form-control"
                                    id="review-venture-total_owing-txt" value="">
                            </div> -->


                        </div>
                        <div class="review form-group row">


                            <label for="review-venture-amount-txt" class="col-sm-1 col-form-label">PHP<span
                                    class="asteriskField">*</span></label>
                            <div class="col-sm-5">
                                <input type="text" readonly class="small-size  review form-control"
                                    id="review-venture-amount-txt" value="">
                            </div>
                            <label for="review-venture-cc-txt" class="col-sm-1 col-form-label">Comm. Money<span
                                    class="asteriskField">*</span></label>

                            <div class="col-sm-5">
                                <input type="text" readonly class="small-size  review form-control"
                                    id="review-venture-cc-txt" value="">
                            </div>

                        </div>

                        <div class="review form-group row">
                            <label for="review-venture-description-txt"
                                class="col-sm-1 col-form-label">Description</label>
                            <div class="col-sm-5">
                                <input type="text" readonly class="small-size  review form-control"
                                    id="review-venture-description-txt" value="">
                            </div>



                        </div>

                        <div class="review-venture-modal-footer" style="text-align:right">
                            <button id="review-back-venture-btn" type="button" data-dismiss="modal"
                                class="btn btn-secondary">Go Back</button>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <button id="review-venture-submit-btn" type="button" class="btn btn-success">Submit
                                Now</button>
                        </div>
                        <div class="venture-edit-modal-footer" style="text-align:left;display:none">
                            <button id="preview-venture-close-btn" type="button" data-dismiss="modal"
                                class="btn btn-secondary">Close</button>
                            &nbsp;&nbsp;&nbsp;&nbsp;
                            <button id="venture-edit-btn" type="button" class="btn btn-primary">Make Changes</button>
                        </div>
                    </form>



                    <!-- ----- end of review form ---- -->


                </div>


                <!-- ----- review form ---- -->

            </div>
        </div>




    </div>




    <script>
        //okss
        var ID_Info = new Object();
        ID_Info.id = "";
        ID_Info.ON_SEARCH = false;
        ID_Info.is_name_blank = true;

        var keys = {};
        var keys_account = { 'W': 'WALLET', 'K': 'CASH' };
        keys["previous-selected-account"] = "CASH";
        keys["PREVIOUS-INPUT"] = "";
        // keys["REQUESTED-ACTION"] = "{{venture.request_action}}".trim().toUpperCase();
        //console.log("previous acct:" + keys["previous-selected-account"]);






        (function () {
            'use strict';
            window.addEventListener('load', function () {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        console.log("submitting......");
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        $(document).ready(function () {


            // this is document ready start


            // qrcode scanner

            let scanner = new Instascan.Scanner(
                {
                    video: document.getElementById('preview')
                }
            );
            scanner.addListener('scan', function (content) {

                //x document.getElementById("venture-customer_id-txt").value = content;
                //x $("#venture-customer_id-txt").val(username);
                search_member(content, "","qrcode");
                beep();
                //xThis is working program
                //x alert('SucceessDo you want to open this page?: ' + content);
                console.log("code: " + content)
                //x window.open(content, "_blank");
            });

            Instascan.Camera.getCameras().then(function (cameras) {
                if (cameras.length > 0) {
                    scanner.start(cameras[0]);
                } else {
                    console.error("Please enable Camera!");
                }
            });
            function beep() {
                (new
                    Audio(
                        "data:audio/wav;base64,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 /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU="
                    )).play();
            }
            // end qrcode scanner
            $("#venture-delete-this").click(function () {
                $("#confim-modal-venture_payment").text("Are you sure you want to delete this payment?");
                $("#yes-no-modal-venture_payment").modal('show');
            });
            confirm_venture_payment(function (confirm) {
                //x var request_action = $(obj).text().trim();
                if (confirm) {

                    document.getElementById('venture-delete').click();

                } else {
                    $("#yes-no-modal-venture_payment").hide();
                }
            });
            var submit_now = false;
            $('form').submit(function (e) {
                console.log(" submitting.... form");
                console.log("submit_now: "+submit_now)
                if (submit_now == false) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                // or return false;
            });

            var post_data = "{{post_data}}";
            var maximum_deposit = parseFloat("{{limits.maximum_deposit}}");

            var minimum_deposit = "{{limits.minimum_deposit}}"; // min amount to deposit for saving account
            var transaction_type = "{{venture.request_action}}";
            console.log("transaction_type:" + transaction_type);
            keys['CC-BALANCE'] = parseFloat("{{asset_balance.cc_balance}}".replace(',', ''));

            console.log("minimum_deposit:" + keys['CC-BALANCE']);

            keys["SOURCE"] = 'K';
            ID_Info.ON_SEARCH = false; // use stop the excessive searching
            ID_Info.id = "";

            $("#id_cc").prop("step", "any");
            $("#id_amount").prop("step", "any");
            $(".source-cash").trigger("click");
            // add class names to form fields
            $("#id_date_entered").prop("class", "form-control");
            $("#id_saving").prop("class", "form-control");
            $("#id_amount").prop("min", minimum_deposit);
            $("#id_amount").prop("max", maximum_deposit);
            if (minimum_deposit > keys['CC-BALANCE']) {
                keys['CC-BALANCE'] = minimum_deposit;
            }
            $("#id_cc").prop("min", minimum_deposit);
            $("#id_cc").prop("max", keys['CC-BALANCE']);
            ///end: set the max and min properties of saving/deposit box
            $("#id_cc").prop("class", "form-control");
            $("#id_percent").prop("step", "any");



            // document.getElementById("venture-customer_id-txt").addEventListener("change", function () {
            //     //This input has changed
            //     customer_id = this.value.trim().toUpperCase();
            //     if (ID_Info.id != customer_id) {
            //         search_member(customer_id,"");
            //     } else {
            //         console.log("leave");
            //     }
            //     console.log("focus");


            // });
            //'input[name="record"]'

            
            $("#btn-login").click(function () {
                //submit_now =true;
                console.log("btn login");
                customer_id = $("#customer_id").val();
                pwd = $("#customer-password").val();
                search_member(customer_id,pwd,"manual")
            });
            function search_member(customer_id, qrpassword,code) {
                console.log("on search_member func");
                console.log("customer_id: "+customer_id)
                console.log("qrpassword: "+qrpassword)
                customer_id = customer_id.trim().toUpperCase();
                var $regexname = /[A-Za-z]{2}[0-9]{2,4}[-]{1}[0-9]{1,4}/g;

                // var match = customer_id.match($regexname);
                // if (match == null || match != customer_id) {
                //     console.log("not match");
                //     if (!ID_Info.is_name_blank) {
                //         $("#customer-name").val("");
                //         ID_Info.is_name_blank = true;
                //     }
                //     return
                // }

                if (ID_Info.id == customer_id) {
                    console.log(" equal...");
                    return;

                } else {
                    console.log("not equal...");
                }
                keys["PREVIOUS-INPUT"] = "";
                ID_Info.id = customer_id;
                var data = {}
                ID_Info.ON_SEARCH = true;
                data['customer_id'] = customer_id;
                if (code == "qrcode") {
                    data['from'] = 'qrcode';
                    //data['qrpassword'] = qrpassword;
                } else {
                    data['password'] = qrpassword;
                    data['from'] = 'manual';
                }
                console.log("reading now..:"+ data['from']);
                $.ajax({
                    type: 'GET',
                    url: "{% url 'fx:get_customer_details_url' %}",
                    data: data,
                    dataType: "json",
                    success: function (response) {
                        ID_Info.ON_SEARCH = false;
                        if (response['data'] == "Success") {
                            //added 4
                            $("#venture-payment-failed-alert").hide();
                            $("#login").modal('hide');
                            $("#venture-payment-transaction-modal").modal('show');

                            name = response["member_info"]['name'].toUpperCase();
                            $("#customer-name").val(name); //change to: appear in summary form
                            cm_balance = response["cm_balance"]
                            if (minimum_deposit > cm_balance) {
                                cm_balance = minimum_deposit;
                            }
                            $("#id_cc").prop("max", cm_balance);

                            
                            customer_id = response["member_info"]["member_id"];
                            console.log("member_info..")
                            console.log(response["member_info"])
                            ID_Info.id = customer_id;
                            ID_Info.is_name_blank = false;
                            $("#review-venture-balance-txt").val(cm_balance);
                            $("#review-venture-customer_id-txt").val(customer_id); //change to: appear in summary form
                            $("#review-venture-customer-txt").val(name); //change to: appear in summary form
                            $("#venture-total-txt").focus();
                        } else {
                            ID_Info.id = "";
                            ID_Info.is_name_blank = true;
                            $("#venture-customer_id-txt").focus();
                            $("#customer-name").val("");
                            message = response['message'];
                            //if (message == "xusername") {
                                //added 4
                            //$("#authenticate-alert").text("Message: Customer ID in QRCODE doest not exist.");
                            //} else {
                                //added 4
                                $("#authenticate-alert").text("Message: " + message);
                          //  }
                            //added 4
                            $("#authenticate-alert").show();

                        }

                    },
                    error: function (response) {
                        ID_Info.ON_SEARCH = false;
                        cancel_dialog_hidden = false;
                        console.log("error reach:");
                        // console.log(response);
                    }
                });
            }
            $("input").keyup(function (event) {
                if (event.target.id == "venture-customer_id-txt" || event.which == 13 && keys["PREVIOUS-INPUT"] == "venture-customer_id") {
                    console.log("inside event");
                    if (keys["PREVIOUS-INPUT"] == "") {
                        keys["PREVIOUS-INPUT"] = "venture-customer_id";
                    }
                    enter_key = false;
                    if (event.which === 13) {
                        customer_id = $("#venture-customer_id-txt").val().trim().toUpperCase();
                        enter_key = true;
                        console.log("inside event.which: 13");
                    } else {
                        customer_id = $(this).val().trim().toUpperCase();
                    }
                    len = customer_id.length;
                    if (len > 11) {
                        return;
                    }
                    // if (enter_key || len >= 8 && !ID_Info.ON_SEARCH && ID_Info.id != customer_id) {
                    //     search_member(customer_id);

                    // }
                } else {
                    keys["PREVIOUS-INPUT"] = "";
                }

            });



            $("#venture-total-txt").on("keyup", function () {
                var percent = parseFloat($("#percent-drop").text());
                if (percent <= 0 || percent > 100 || isNaN(percent)) {
                    percent = 95;
                    $("#percent-drop").text(percent + "%");
                }
                total_cost = parseFloat($(this).val());
                if (isNaN(total_cost)) {
                    total_cost = 0;
                }
                var amount = total_cost * ((percent / 100))   //Math.round(total_cost * ((cc_percent / 100)));
                amount = amount.toFixed(2).replace('.00', '');
                $("#id_amount").val(amount);
                cc = total_cost - amount;
                $("#id_cc").val(cc.toFixed(2).replace('.00', ''));
                if (keys["SOURCE"] != 'W') {  //cash: K
                    console.log("in keys[SOURCE]: " + keys["SOURCE"]);
                    $("#venture-total_owing-txt").val("P " + amount);
                } else {
                    $("#venture-total_owing-txt").val("DEDUCTED FROM WALLET ACCOUNT.");
                }
            });

            $("#id_amount").on("keyup", function () {
                console.log(" #id_amount is on");
                amount = parseFloat($(this).val());
                if (isNaN(amount)) {
                    amount = 0;
                }
                total_cost = parseFloat($("#venture-total-txt").val());
                var cc = total_cost - amount;  // Math.round(total_cost - amount);
                cc = cc.toFixed(2).replace('.00', '');
                $("#id_cc").val(cc);
                percent = (amount * 100) / total_cost // Math.round((amount * 100) / total_cost);
                if (percent <= 0 || percent > 100 || isNaN(percent) == NaN) {
                    percent = 95;
                    $("#percent-drop").text(percent + "%");
                }
                $("#id_percent").val(percent.toFixed(2))
                percent = percent.toFixed(2).replace('.00', '');
                if (isNaN(percent)) {
                    percent = 0;
                }
                $("#percent-drop").text(percent + "%");
                console.log("in keys[SOURCE]: " + keys["SOURCE"]);
                if (keys["SOURCE"] != 'W') {  //cash: K
                    console.log("in keys[SOURCE]: " + keys["SOURCE"]);
                    if (amount > 0) {
                        $("#venture-total_owing-txt").val("P " + amount);
                    } else {
                        $("#venture-total_owing-txt").val("");
                    }
                } else {

                    $("#venture-total_owing-txt").val("DEDUCTED FROM WALLET ACCOUNT.");
                }


            });
            $("#id_cc").on("keyup", function () {
                var percent = parseFloat($("#percent-drop").text());
                if (percent <= 0 || percent > 100 || isNaN(percent) == NaN) {
                    percent = 95;
                    console.log("changing percent");
                    $("#percent-drop").text(percent + "%");
                }
                cc = parseFloat($(this).val());
                total_cost = parseFloat($("#venture-total-txt").val());
                var amount = 0; //Math.round(total_cost - cc);
                amount = total_cost - cc;
                percent = (amount * 100) / total_cost; /// Math.round((amount * 100) / total_cost);
                if (isNaN(percent)) {
                    percent = 0
                }
                if (isNaN(amount)) {
                    amount = 0
                }
                $("#id_amount").val(amount);
                $("#id_percent").val(percent.toFixed(2))
                percent = percent.toFixed(2).replace('.00', '');
                $("#percent-drop").text(percent + "%");
                if (keys["SOURCE"] != 'W') {  //cash: K
                    console.log("in keys[SOURCE]: " + keys["SOURCE"]);
                    $("#venture-total_owing-txt").val("P " + amount);
                } else {

                    $("#venture-total_owing-txt").val("DEDUCTED FROM WALLET ACCOUNT.");
                }
            });


            $(".dropdown-menu button.cc-percent").click(function () {

                var new_percentage = $(this).text(); //.replace(" Percent","%");
                console.log("..percent: " + new_percentage);
                $("#percent-drop").text(new_percentage);
                $("#id_percent").val(parseFloat(new_percentage))
                $("#venture-total-txt").trigger("keyup");
            });

            if (post_data == "True") {


                $('#venture-customer_id-txt').css("background-color", "transparent");
                $('#venture-total-txt').css("background-color", "transparent");
                $('#id_cc').css("background-color", "transparent");
                $('#id_amount').css("background-color", "transparent");
                $('#percent-drop').css("background-color", "transparent");
                $('#source-cash-drop').css("background-color", "transparent");
                $('#venture-customer_id-txt').prop("disabled", true);

                $('#venture-total-txt').prop("disabled", true);
                $('#id_cc').prop("disabled", true);
                $('#id_amount').prop("disabled", true);
                $('#percent-drop').prop("disabled", true);
                $('#source-cash-drop').prop("disabled", true);
            }

            // $(".role_type").click(function () {
            //     var text = $(this).text().trim();
            //     $("#role_type-drop").text(text);
            //     if (text.trim() == "BUYER") {
            //         role_type = "B";
            //         $("#venture-total_owing-lbl").text("BUYER PAYS");
            //         $("#review-total_owing-txt").text("BUYER PAYS");
            //     } else {

            //         role_type = "S";
            //         $("#venture-total_owing-lbl").text("SELLER RECEIVES");
            //         $("#review-total_owing-txt").text("SELLER RECEIVES");
            //     }
            //     $("#id_role_type").val(role_type);

            // })

            $(".source-cash").click(function () {
                var text = $(this).text().trim();
                $("#source-cash-drop").text(text);
                var max = 0
                account_name = ""
                if (text == "CASH") {
                    source_type = "K";
                    // max = 10000;
                    account_name = "CASH";

                } else {
                    source_type = "W";
                    account_name = "WALLET";
                    keys['CC-BALANCE']

                }
                keys["SOURCE"] = source_type;
                $("#id_source_type").val(source_type);

                var previous_account_name = keys["previous-selected-account"]; // previous account  [wallet,cc,saving]
                console.log("account:" + previous_account_name);
                if (previous_account_name != "CASH") {

                    $("#account-assets-table tr").find('#' + previous_account_name).removeAttr("class", "selected_account");
                    $("#financial-table tr").find('#' + previous_account_name).removeAttr("class", "selected_account");
                }
                if (account_name != "CASH") {
                    $("#account-assets-table tr").find('#' + account_name).attr("class", "selected_account");
                    $("#financial-table tr").find('#' + account_name).attr("class", "selected_account");
                }
                keys["previous-selected-account"] = account_name;
                if (keys["SOURCE"] != 'W') {  //cash: K
                    amount = $("#id_amount").val();
                    console.log("in keys[SOURCE]: " + keys["SOURCE"]);
                    $("#venture-total_owing-txt").val("P " + amount);
                } else {
                    $("#venture-total_owing-txt").val("DEDUCTED FROM WALLET ACCOUNT.");
                }

            });

            $(".edit_button").click(function () {
                $('.submit').prop("disabled", false);
                $(".alert").hide();
                $(this).hide();
            });
            $("#id_date_entered").css("background-color", "transparent");
            // $("#venture-submit-btn").hide();
            $("#review-venture-submit-btn").click(function () {
                submit_now = true;
                console.log("submit review-venture-submit-btn....");
                $("#venture-submit-btn").trigger("click");
            });


            $("#venture-done").click(function () {
                var form = document.querySelector(".needs-validation");
                var reportVal = form.checkValidity();
                if (reportVal == false) {

                    $("#venture-payment-failed-alert").show();
                    form.reportValidity();
                    return;
                }
                console.log("success");

                $("#login").modal('show');

                $("#review-venture-customer-txt").val($("#customer-name").val()); // for review form
                $("#review-venture-date-txt").val($("#venture-date-txt").val());
                $("#review-venture-customer_id-txt").val($("#venture-customer_id-txt").val());
                $("#review-venture-total-txt").val($("#venture-total-txt").val());
                $("#review-venture-total_owing-txt").val($("#venture-total_owing-txt").val());
                $("#review-venture-cc-txt").val($("#id_cc").val());
                $("#review-venture-amount-txt").val($("#id_amount").val());
                $("#review-venture-source-txt").val($("#source-cash-drop").text().trim());
                $("#review-venture-percentage-txt").val($("#percent-drop").text().trim());
                $("#review-venture-description-txt").val($("#venture-description-txt").val().trim());

                $("#venture-payment-failed-alert").hide();

            });




        });
    </script>


    {% endblock sub_content %}

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
